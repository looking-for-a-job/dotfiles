#!/usr/bin/env python
# -*- coding: utf-8 -*-
import datetime
import my_tasks
from task.models import Task

"""
каждые 50 мин на 10 мин
"""


class Timeout_10m(my_tasks.Now):
    name = "Перерыв на 10 минут"

    @property
    def disabled(self):
        if datetime.datetime.now().hour < 6:  # ночью нельзя греметь
            return True
        return False

    def todo(self):
        if self.elapsed and self.elapsed < 50*60:
            return
        if self.shell("afk")>120:
            return False
        if self.psql('SELECT COUNT(*) FROM last_60minutes WHERE available=true',"afk")<50:
            return
        if self.psql('SELECT COUNT(*) FROM last_50minutes WHERE min_afk>60',"afk")>10:
            return
        if self.psql('SELECT COUNT(*) FROM last_50minutes WHERE max_afk<60',"afk") < 25:
            return
        if self.psql('SELECT COUNT(*) FROM last_50minutes WHERE max_afk<60',"afk") < 5:
            return
        return True

if __name__ == "__main__":
    print(Task.objects.get(class_name=Timeout_10m.__name__))
